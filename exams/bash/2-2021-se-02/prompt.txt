Зад. 45 2021-SE-02

Един от често използваните DNS сървъри е BIND9, при който описанието на DNS зоните обикновенно
стои в текстови файлове, наричани зонални файлове. За улеснение, в рамките на задачата, ще ползваме
опростено описание на зоналните файлове.
Под whitespace разбираме произволна комбинация от табове и интервали.
Под FQDN разбираме низ, който има допустими символи малки латински букви, цифри и точка; не
може да започва с точка, не може да има две или повече съседни точки, задължително завършва с
точка.
Зоналните файлове съдържат ресурсни записи, по един на ред. Общият вид на даден ресурсен запис e
< к л ю ч > < T T L > < к л а с > < т и п > < R D A T A > , разделени с whitespace, например:
a s t e r o . o p e n f m i . n e t . 3 6 0 0 I N A 1 8 5 . 1 1 7 . 8 2 . 9 9

Където:
• ключ (a s t e r o . o p e n f m i . n e t . ) – FQDN
• TTL (3 6 0 0 ) – цифри; полето може да липсва
• клас (I N ) - главни латински букви; класът винаги е I N
• тип (A ) - главни латински букви; някое от S O A , N S , A , A A A A
• RDATA (1 8 5 . 1 1 7 . 8 2 . 9 9 ) - данни на записа; различни за различните типове ресурсни записи;
всичко след типа до края на реда.
Знакът точка-и-запетая ; е знак за коментар, и всичко след него до края на реда се игнорира.
Във всеки зонален файл трябва да има точно един SOA запис, и той трябва да е първият запис във
файла. Пример за едноредов SOA запис:
o p e n f m i . n e t . 3 6 0 0 I N S O A n i m b u s . f c c f . n e t . r o o t . f c c f . n e t . 2 0 2 1 0 4 1 9 0 1 8 6 4 0 0 7 2 0 0 3 0 2 4 0 0 0 3 6 0 0
RDATA-та на SOA запис се състои от два FQDN-а и пет числа, разделени с whitespace.
Въпреки, че горното е валиден SOA запис, за прегледност в зоналните файлове често се ползва следният
синтаксис (многоредов SOA запис, еквивалентен на горния)
o p e n f m i . n e t . 3 6 0 0 I N S O A n i m b u s . f c c f . n e t . r o o t . f c c f . n e t . (
2 0 2 1 0 4 1 9 0 1 ; s e r i a l
8 6 4 0 0 ; r e f r e s h
7 2 0 0 ; r e t r y
3 0 2 4 0 0 0 ; e x p i r e
3 6 0 0 ; n e g a t i v e T T L
)
т.е., поредицата от числа се разбива на няколко реда, оградени в обикновенни скоби, и за всяко число
се слага коментар какво означава.
Първото от тези числа (serial) представлява серийният номер на зоната, който трябва да се увеличава
всеки път, когато нещо в зоналният файл се промени. Изключително важно е това число само да

нараства, и никога да не намалява.
Един от често използваните формати за сериен номер, който показва кога е настъпила последната
промяна в зоналния файл представлява число във вида YYYYMMDDTT, т.е., четири цифри за година,
две цифри за месец, две цифри за дата и още две цифри за поредна промяна в рамките на описания

ден. За последните две цифри (ТТ) има ограничение да са от 00 до 99 (естествено, така не може да има
повече от 100 промени в рамките на един ден).
За удобство приемаме, че конкретен сериен номер (точната поредица цифри) се среща само на едно
място в зоналния файл.
Напишете шел скрипт, който по подадени имена на зонални файлове променя серийният номер в
SOA записа на всеки файл по следният алгоритъм:
• ако датата в серийният номер е по-стара от днешната, новият сериен номер трябва да е от вида
д н е ш н а д а т а 0 0
• ако датата в серийният номер е равна на днешната, серийният номер трябва да се увеличи с
единица
Важат следните условия:
• скриптът трябва да може да обработва и едноредови, и многоредови SOA записи
• за всеки зонален файл, който не е успял да обработи, скриптът трябва да вади съобщение за
грешка, което включва и името на зоналния файл. Съобщенията трябва да са лесно обработваеми
с познатите инструменти за обработка на текст.
