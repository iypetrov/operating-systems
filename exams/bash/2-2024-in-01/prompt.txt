2024-IN-01

Вашите колеги от съседната лаборатория се нуждаят от shell скрипт, с който да автоматизират синхронизацията
на директории между различни сървъри. Скриптът трябва да е базиран на командата r s y n c , която има
следният общ вид:
r s y n c [ O P T I O N . . . ] S R C D E S T

В рамките на задачата ще ползваме следният опростен синтаксис за командата:
• при зададена опция - a и ако SRC и DEST са абсолютни пътища до директории завършващи
с наклонена черта (/ p a t h / t o / d i r / ), командата ще направи пълна синхронизация на всички
обекти (файлове и директории) рекурсивно от SRC в DEST, запазвайки времената, правата и
собствениците на обектите, които копира;
32
• двете директории SRC и DEST биха могли да са локални или само една от тях може да е директория
на друг сървър, в който случай синтаксисът е u s e r n a m e @ s e r v e r : / p a t h / t o / d i r /
• синхронизацията винаги е от SRC към DEST, без значение дали и двете са локални директории
или една от тях е отдалечена;
• при зададена опция - - d e l e t e обекти, които съществуват в DEST, но не и в SRC, ще бъдат изтрити
за да може DEST да е точно копие на SRC;
• при зададена опция - v командата извежда имената на обектите които синхронизира;
• при зададена опция - n реална синхронизация не се извършва, командата само пресмята кои
обекти трябва да се синхронизират, и ако има указана и опция - v извежда имената им.
Напишете скрипт, който да може да автоматизира синхронизацията на директория между текущата
машина (на която се изпълнява скрипта) и една или повече отдалечени машини. Работата на скрипта
зависи от текстови конфигурационен файл, чието име би трябвало да е указано в environment променливата

A R K C O N F . Всеки ред на файла е във вид на k e y = v a l u e двойки, например:
W H A T = " / h o m e / a m a r r / s y n c "
W H E R E = " a b a d d o n a p o s t l e a r c h o n a u g u r "
W H O = " h e i d e r a n "
Където:
• W H A T дефинира абсолютен път до директорията, която трябва да се синхронизира, като дефиницията
се отнася както за локалната директория (на машината на която се изпълнява скрипта), така и
за отдалечените сървъри, т.е., директорията има еднакво абсолютно име на всички машини;
• W H E R E дефинира списък със сървъри, с които да се извършва синхронизация, като е гарантирано,
че имената на сървърите са само малки латински букви и първата буква е винаги ‘a ’;
• W H O дефинира username, който да се ползва за достъп до отдалечените сървъри (всички сървъри
ползват този username).
За нормална работа на вашия скрипт се изисква и трите ключа да са дефинирани, като за удобство
приемаме, че стойностите им точно спазват примерния формат. Комбинацията от вашият скрипт и
валиден конфигурационен файл ще наричаме система за синхронизация. Общ вид на извикване на
скрипта: a r k . s h p u s h | p u l l [ - d ] [ s e r v e r ] където:
• аргументите не са позиционни, т.е. нямат наредба;

• аргументите, оградени в квадратни скоби (- d , s e r v e r ) не са задължителни;
• ако е зададен валиден за системата параметър server, синхронизацията се извършва само между
локалната машина и този сървър;
• ако не указан server, синхронизацията се извършва между локалната машина и всеки от сървърите
итеративно (по сървърите);
• ако е зададена опция - d , синхронизацията трябва да се извършва с включена опция - - d e l e t e
на командата r s y n c ;
• задължително трябва да е дефиниран точно един от аргументите p u s h или p u l l , тъй като те са
под-команди, които определят посоката на синхронизация:
– при p u s h – от локалната машина към отдалечените сървъри;
– при p u l l – от отдалечените сървъри към локалната машина.
Примерни валидни извиквания:
a r k . s h p u s h - d
a r k . s h - d a b a d d o n p u l l
a r k . s h a p o s t l e p u l l
Всяка синхронизация в рамките на работата на системата е тристъпкова – скриптът трябва да:

• изведе на потребителя какво ще бъде синхронизирано;

• изиска някакъв вид потвърждение от потребителя;
• извърши конкретната синхронизация.
Обърнете внимание на валидацията, искаме системата за синхронизация да е устойчива на невнимателно

подадени параметри
